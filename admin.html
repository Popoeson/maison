<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MAISON Admin Panel</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg-main:#F5F0E1;
  --glass-bg:rgba(255,255,255,0.55);
  --glass-border:rgba(255,255,255,0.35);
  --glass-dark:rgba(25,25,25,0.55);
  --text-dark:#2A2A2A;
  --text-muted:#6F6F6F;
  --accent-olive:#6B8E23;
  --success:#6FAE7B;
  --error:#D9534F;
  --blur:blur(18px);
}

*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg-main);
  font-family:Inter,sans-serif;
  color:var(--text-dark);
}

/* LAYOUT */
.admin-wrapper{display:flex;min-height:100vh}

/* SIDEBAR */
.sidebar{
  width:260px;position:fixed;inset:0 auto 0 0;
  background:var(--glass-dark);
  backdrop-filter:var(--blur);
  color:#fff;padding:28px 18px;z-index:1000
}
.sidebar h2{font-family:"Playfair Display";margin-bottom:40px}
.sidebar li{
  list-style:none;padding:14px;border-radius:14px;
  cursor:pointer;margin-bottom:10px
}
.sidebar li:hover,.sidebar li.active{background:rgba(255,255,255,0.18)}

.main{margin-left:260px;padding:28px;width:100%}

/* GLASS */
.glass{
  background:var(--glass-bg);
  backdrop-filter:var(--blur);
  border:1px solid var(--glass-border);
  border-radius:22px;
}

/* BUTTON */
.btn{
  padding:10px 22px;border-radius:999px;
  border:none;cursor:pointer;
  background:var(--accent-olive);
  color:#fff;font-weight:500
}

/* TABLE */
table{width:100%;border-collapse:collapse;min-width:700px}
th,td{padding:16px;font-size:14px}
th{color:var(--text-muted)}
tr:not(:last-child){border-bottom:1px solid rgba(0,0,0,.08)}
.table-wrapper{overflow-x:auto}

/* MODAL */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.45);
  display:none;align-items:center;justify-content:center;z-index:2000
}
.modal-content{
  width:90%;max-width:500px;padding:26px;
  display:flex;flex-direction:column;gap:12px
}
.modal-content input,textarea,select{
  padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,.1)
}

/* IMAGE PREVIEW */
.image-preview{display:flex;gap:12px;flex-wrap:wrap}
.preview-box{
  position:relative
}
.preview-box img{
  width:80px;height:80px;object-fit:cover;
  border-radius:14px;border:1px solid rgba(0,0,0,.15)
}
.preview-box label{
  position:absolute;bottom:-6px;left:50%;
  transform:translateX(-50%);
  font-size:11px;background:#fff;
  padding:3px 6px;border-radius:8px
}

/* LOADING */
.loading-overlay{
  position:fixed;inset:0;background:rgba(245,240,225,.6);
  backdrop-filter:blur(6px);
  display:none;align-items:center;justify-content:center;z-index:3000
}
.spinner{
  width:60px;height:60px;border-radius:50%;
  border:4px solid rgba(0,0,0,.15);
  border-top:4px solid var(--accent-olive);
  animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}

/* TOAST */
.toast{
  position:fixed;bottom:30px;right:30px;
  padding:14px 22px;border-radius:16px;
  color:#fff;font-size:14px;
  backdrop-filter:blur(12px);
  animation:slideIn .4s ease;
  z-index:4000
}
.toast.success{background:rgba(107,142,35,.85)}
.toast.error{background:rgba(217,83,79,.85)}
@keyframes slideIn{
  from{transform:translateY(20px);opacity:0}
  to{transform:translateY(0);opacity:1}
}
</style>
</head>

<body>

<div class="admin-wrapper">
  <aside class="sidebar">
    <h2>MAISON</h2>
    <li class="active">Products</li>
  </aside>

  <main class="main">
    <div class="glass" style="padding:18px;margin-bottom:20px">
      <strong>MAISON ADMIN PANEL</strong>
    </div>

    <div style="display:flex;justify-content:space-between;margin-bottom:18px">
      <h3 style="font-family:'Playfair Display'">Products</h3>
      <button class="btn" onclick="openModal()">+ Add Product</button>
    </div>

    <div class="glass table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Main Image</th><th>Name</th><th>Price</th><th>Qty</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="productsTable"></tbody>
      </table>
    </div>
  </main>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content glass">
    <h3>Add Product</h3>

    <input id="name" placeholder="Name">
    <input id="price" type="number" placeholder="Price">
    <input id="qty" type="number" placeholder="Quantity">
    <input id="imgCount" type="number" min="1" max="5" placeholder="Number of images">

    <div id="imageInputs"></div>
    <div class="image-preview" id="preview"></div>

    <button class="btn" onclick="saveProduct()">Save</button>
    <button class="btn" style="background:#ccc;color:#333" onclick="closeModal()">Cancel</button>
  </div>
</div>

<div class="loading-overlay" id="loading"><div class="spinner"></div></div>

<script>
const API='https://maison-90o3.onrender.com'
const modal=document.getElementById('modal')
const loading=document.getElementById('loading')
const preview=document.getElementById('preview')

let mainIndex=0

function toast(msg,type='success'){
  const t=document.createElement('div')
  t.className=`toast ${type}`
  t.innerText=msg
  document.body.appendChild(t)
  setTimeout(()=>t.remove(),3000)
}

function openModal(){modal.style.display='flex'}
function closeModal(){modal.style.display='none'}

imgCount.oninput=e=>{
  imageInputs.innerHTML=''
  preview.innerHTML=''
  mainIndex=0

  for(let i=0;i<e.target.value;i++){
    const input=document.createElement('input')
    input.type='file'
    input.accept='image/*'

    input.onchange=()=>{
      const box=document.createElement('div')
      box.className='preview-box'
      box.innerHTML=`
        <img src="${URL.createObjectURL(input.files[0])}">
        <label>
          <input type="radio" name="mainImg" ${i===0?'checked':''}
            onchange="mainIndex=${i}">
          Main
        </label>
      `
      preview.appendChild(box)
    }
    imageInputs.appendChild(input)
  }
}

async function saveProduct(){
  try{
    loading.style.display='flex'
    const fd=new FormData()
    fd.append('name',name.value)
    fd.append('price',price.value)
    fd.append('quantity',qty.value)
    fd.append('mainIndex',mainIndex)

    document.querySelectorAll('#imageInputs input').forEach(i=>{
      if(i.files[0]) fd.append('images',i.files[0])
    })

    await fetch(`${API}/api/products`,{method:'POST',body:fd})
    toast('Product saved successfully')
    closeModal()
  }catch{
    toast('Something went wrong','error')
  }finally{
    loading.style.display='none'
  }
}
</script>

</body>
</html>